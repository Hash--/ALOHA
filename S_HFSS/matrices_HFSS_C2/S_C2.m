
S_mod_multi_jonction =[ 0.0300    0.5000    0.5000    0.5000    0.5000
    	    0.5000    0.4510    0.6510    0.2490    0.2490
    	    0.5000    0.6510    0.4510    0.2490    0.2490
    	    0.5000    0.2490    0.2490    0.4510    0.6510
    	    0.5000    0.2490    0.2490    0.6510    0.4510];



S_phase_multi_jonction = [ 2.2490  111.2080 -158.7920  -68.7920   21.2080
 	  111.2080   49.7180   10.2200  -39.4090   50.5910
 	 -158.7920   10.2200 -130.2810   50.5910  140.5910
  	  -68.7920  -39.4090   50.5910   49.7180   10.2200
   	   21.2080   50.5910  140.5910   10.2200 -130.2810];


S_M = S_mod_multi_jonction.*exp(i*S_phase_multi_jonction*pi./180);

phi_hybrid = 0;

S_H = [0         i/sqrt(2)                  1/sqrt(2)
       i/sqrt(2) exp(i*phi_hybrid)/2        exp(i*(phi_hybrid+pi/2))/2
       1/sqrt(2) exp(i*(phi_hybrid+pi/2))/2 -exp(i*phi_hybrid)/2];


S_tot = [[S_H(1,1),   zeros(1,4),   zeros(1,4),   S_H(1,2),   S_H(1,3),   0,          0         ];
         [zeros(4,1), S_M(2:5,2:5), zeros(4,4),   zeros(4,1), zeros(4,1), S_M(2:5,1), zeros(4,1)];
         [zeros(4,1), zeros(4,4),   S_M(2:5,2:5), zeros(4,1), zeros(4,1), zeros(4,1), S_M(2:5,1)];        
         [S_H(2,1),   zeros(1,4),   zeros(1,4),   S_H(2,2),   S_H(2,3),   0,          0         ];
         [S_H(3,1),   zeros(1,4),   zeros(1,4),   S_H(3,2),   S_H(3,3),   0,          0         ];
         [0,          S_M(1,2:5),   zeros(1,4),   0,          0,          S_M(1,1),   0         ];	 	 
         [0 ,         zeros(1,4),   S_M(1,2:5),   0,          0,          0,          S_M(1,1)  ] ];


	 
S_connex=[0 0 1 0
          0 0 0 1
	  1 0 0 0
	  0 1 0 0 ];




S = S_tot(1:9,1:9) + S_tot(1:9,10:13)*inv(S_connex - S_tot(10:13,10:13))*S_tot(10:13,1:9);

S(1,6:9) = S(1,6:9)*exp(i*pi/4);
S(2:5,6:9) = S(2:5,6:9)*exp(i*pi/4);
S(6:9,1) = S(6:9,1)*exp(i*pi/4);
S(6:9,2:5) = S(6:9,2:5)*exp(i*pi/4);
S(6:9,6:9) = S(6:9,6:9)*exp(i*pi/2);

S_test = S;


S = reshape(S,1,length(S)*length(S)); 
